.PHONY: up down update logs restart build clean status help

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É docker compose (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∏ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π)
DOCKER_COMPOSE := $(shell if command -v docker-compose >/dev/null 2>&1; then echo "docker-compose"; else echo "docker compose"; fi)

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
up:
	@echo "üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
	$(DOCKER_COMPOSE) up -d
	@echo "‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!"
	@echo "üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤: make logs"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
down:
	@echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞..."
	$(DOCKER_COMPOSE) down
	@echo "‚úÖ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ git + –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ + –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
update:
	@echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞..."
	@bash scripts/update.sh

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
logs:
	@echo "üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ (Ctrl+C –¥–ª—è –≤—ã—Ö–æ–¥–∞)..."
	$(DOCKER_COMPOSE) logs -f bot

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞
restart:
	@echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
	$(DOCKER_COMPOSE) restart
	@echo "‚úÖ –ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω"

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞
build:
	@echo "üî® –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞..."
	$(DOCKER_COMPOSE) build --no-cache
	@echo "‚úÖ –û–±—Ä–∞–∑ —Å–æ–±—Ä–∞–Ω"

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞..."
	$(DOCKER_COMPOSE) down -v --rmi all
	@echo "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
status:
	@$(DOCKER_COMPOSE) ps

# –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ
deploy:
	@echo "üöÄ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ..."
	@bash scripts/deploy.sh

# –°–ø—Ä–∞–≤–∫–∞
help:
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo "  make up       - –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞"
	@echo "  make down     - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞"
	@echo "  make update   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ git –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫"
	@echo "  make logs     - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤"
	@echo "  make restart  - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"
	@echo "  make build    - –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞"
	@echo "  make clean    - –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞"
	@echo "  make status   - –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞"
	@echo "  make deploy   - –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ"
